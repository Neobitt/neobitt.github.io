import{initializeApp}from"https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";import{getFirestore,doc,getDoc,updateDoc,increment,onSnapshot,collection,query,orderBy}from"https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";if("file:"===window.location.protocol)console.error("‚ùå Error: Los m√≥dulos ES no funcionan en file://"),alert("Error: Esta p√°gina debe ejecutarse en un servidor HTTP/HTTPS.");else{try{const a={apiKey:"AIzaSyDp7VT6HMYBgqnrYfc84Tk9kh82nCBTYtM",authDomain:"dpccrea-login.firebaseapp.com",projectId:"dpccrea-login",appId:"1:822726011803:web:6b8f3e6a9d8c7b2e8f4e5d"},b=initializeApp(a),c=getFirestore(b),d=doc(c,"visitas","contador"),e=document.getElementById("visitor-counter"),f=JSON.parse(localStorage.getItem("dpccrea_user"))||{},g=collection(c,"comentarios"),h=query(g,orderBy("timestamp","desc")),i=new Set;j(h,a=>{a.forEach(a=>i.add(a.id)),a.docChanges().forEach(a=>{"added"===a.type&&a.doc&&a.doc.data&&a.doc.data().name!==f.username&&i.add(a.id)&&(k(`${a.doc.data().name||"An√≥nimo"}: "${(a.doc.data().message||"").length>50?(a.doc.data().message||"").substring(0,47)+"...":a.doc.data().message||""}"`))})},a=>console.error("‚ùå Error al escuchar comentarios:",a));const k=a=>{let b=document.createElement("div");b.className="notification",b.style.cssText="position: fixed; top: 20px; right: 20px; background: rgba(0, 0, 0, 0.95); border: 2px solid var(--neon-cyan); color: white; padding: 15px; border-radius: 8px; z-index: 10000; max-width: 300px; box-shadow: 0 0 20px var(--neon-cyan), 0 0 10px var(--inclusive-purple); font-family: 'Courier New', monospace; animation: notifIn 0.5s ease-out; pointer-events: auto;",b.innerHTML=`<strong style="color: var(--neon-cyan);"><i class="fas fa-bell"></i> Nuevo comentario</strong><p style="margin: 8px 0; color: var(--golden-accent); font-size: 0.9rem;">${a}</p>`,document.body.appendChild(b);let c=document.createElement("style");c.textContent="@keyframes notifIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}@keyframes notifOut{from{transform:translateX(0);opacity:1}to{transform:translateX(100%);opacity:0}}",document.head.appendChild(c),setTimeout(()=>{b.style.animation="notifOut 0.5s ease-out",setTimeout(()=>{b.parentElement&&document.body.removeChild(b)},500)},5e3)},l=()=>{let a=new Audio("https://assets.codepen.io/3011180/notification-sound-1.mp3");a.volume=.3,a.play().catch(b=>console.error("‚ùå Error al reproducir sonido:",b))};onSnapshot(d,a=>{a.exists()?e.innerHTML=`<strong>Visitas: ${new Intl.NumberFormat().format(a.data().count)}</strong>`:e.innerHTML='<span class="counter-fallback">0</span>'},a=>{console.error("‚ùå Error al escuchar contador:",a),e.innerHTML='<span class="counter-fallback">[--]</span>'});const m=localStorage.getItem("dpccrea_lastVisit"),n=Date.now(),o=432e5;m&&!(n-parseInt(m)>o)||updateDoc(d,{count:increment(1)}).then(()=>{localStorage.setItem("dpccrea_lastVisit",n.toString()),console.log("%cüìà Contador incrementado","color: #FFD700")}).catch(a=>console.error("‚ùå Error al aumentar contador:",a))}catch(a){console.error("‚ùå Error al inicializar Firebase:",a.message),alert("No se pudo inicializar Firebase. Verifica la configuraci√≥n o la conexi√≥n.")}}